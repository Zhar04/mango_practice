<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Level Assessment</title>
    <!-- docx library for Word export -->
    <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fef6f0 0%, #f0f4ff 100%);
            min-height: 100vh;
        }

        .main-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 30px 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.3em;
        }

        .sidebar-item {
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
            border-left: 4px solid transparent;
        }

        .sidebar-item:hover {
            background: #fff5f0;
            border-left-color: #ff8c00;
            transform: translateX(5px);
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #fff5f0 0%, #f0f7ff 100%);
            border-left-color: #3498db;
            font-weight: 600;
        }

        .sidebar-item.completed {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }

        .content {
            margin-left: 260px;
            padding: 40px;
            flex: 1;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 40px;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px auto;
            max-width: 900px;
        }

        .variant-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px auto;
            max-width: 600px;
        }

        .card {
            background: linear-gradient(135deg, #fff5f0 0%, #f0f7ff 100%);
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 140, 0, 0.2);
            border-color: #ff8c00;
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .card p {
            color: #7f8c8d;
            line-height: 1.6;
        }

        .question {
            background: #fafafa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #ff8c00;
        }

        .question h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .question-header h4 {
            margin-bottom: 0;
        }

        .hint-btn {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            border: 1px solid #ffc107;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .hint-btn:hover {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(255, 193, 7, 0.4);
        }

        .answer-key {
            display: none;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 12px 15px;
            margin-top: 15px;
            color: #2e7d32;
            font-weight: 500;
        }

        .answer-key.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .options {
            margin-top: 15px;
        }

        .option {
            display: block;
            margin: 10px 0;
        }

        .option input {
            margin-right: 10px;
        }

        .option label {
            cursor: pointer;
            color: #34495e;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            margin-top: 10px;
            resize: vertical;
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: #ff8c00;
        }

        .media-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .audio-player, .video-player {
            width: 100%;
            max-width: 100%;
            border-radius: 10px;
            margin-top: 10px;
        }

        .chart-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .reading-text {
            background: white;
            padding: 25px;
            border-radius: 10px;
            line-height: 1.8;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
        }

        .cue-card {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe6f0 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px dashed #ff8c00;
        }

        .timer {
            background: #ff8c00;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px 0;
            font-weight: bold;
        }

        .results {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .result-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .result-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .score {
            font-size: 2em;
            font-weight: bold;
            color: #ff8c00;
            margin: 10px 0;
        }

        .recommendation {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: #e65100;
        }

        .grammar-topic {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            color: #1565c0;
            border-left: 3px solid #2196f3;
        }

        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .nav-btn:hover {
            background: #2980b9;
            transform: scale(1.05);
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6b00 100%);
        }

        .nav-btn.primary:hover {
            background: linear-gradient(135deg, #ff6b00 0%, #ff4500 100%);
        }

        .instruction-note {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            
            .content {
                margin-left: 0;
                padding: 20px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }

            .level-selector, .variant-selector {
                grid-template-columns: 1fr;
            }

            .main-container {
                flex-direction: column;
            }
        }

        .match-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .match-item {
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .show-answers-btn {
            background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin: 20px 0;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .show-answers-btn:hover {
            background: linear-gradient(135deg, #7b1fa2 0%, #6a1b9a 100%);
            transform: scale(1.05);
        }

        .show-answers-btn.active {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .option.correct-answer {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 5px 0;
            border-left: 4px solid #4caf50;
        }

        .option.wrong-answer {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 5px 0;
            border-left: 4px solid #f44336;
        }

        .option.correct-answer label,
        .option.wrong-answer label {
            font-weight: 600;
        }

        .answer-indicator {
            font-size: 0.85em;
            margin-left: 10px;
            font-weight: bold;
        }

        .answer-indicator.correct {
            color: #2e7d32;
        }

        .answer-indicator.wrong {
            color: #c62828;
        }

        .input-answer-display {
            margin-top: 10px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }

        .input-answer-display.show {
            display: block;
        }

        .input-answer-display.correct {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 4px solid #4caf50;
            color: #2e7d32;
        }

        .input-answer-display.wrong {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-left: 4px solid #f44336;
            color: #c62828;
        }

        .writing-answer-btn {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .writing-answer-btn:hover {
            background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
            transform: scale(1.05);
        }

        .writing-answer-container {
            display: none;
            margin-top: 15px;
            padding: 20px;
            background: #fafafa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .writing-answer-container.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .writing-answer-container h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #2196f3;
            padding-bottom: 8px;
        }

        .writing-answer-container pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            font-family: inherit;
            line-height: 1.6;
            color: #34495e;
        }

        .copy-btn {
            background: #607d8b;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85em;
            margin-left: 10px;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #455a64;
        }

        .copy-btn.copied {
            background: #4caf50;
        }

        .export-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #7c4dff;
        }

        .export-fields {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .field-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .field-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }

        .field-group input,
        .field-group textarea {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .field-group input:focus,
        .field-group textarea:focus {
            outline: none;
            border-color: #7c4dff;
        }

        .export-btn {
            background: linear-gradient(135deg, #7c4dff 0%, #651fff 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .export-btn:hover {
            background: linear-gradient(135deg, #651fff 0%, #5e35b1 100%);
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(124, 77, 255, 0.4);
        }

        .export-btn:disabled {
            background: #bdbdbd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div id="initialScreens">
        <div class="content" style="margin-left: 0;">
            <div class="container">
                <h1>Language Level Assessment</h1>
                <p class="subtitle">Comprehensive English Proficiency Test</p>

                <!-- Level Selection -->
                <div id="levelSelection" class="section active">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">Choose Your Level</h2>
                    <div class="level-selector">
                        <div class="card" onclick="selectLevel('A0')">
                            <h3>A0 - Beginner</h3>
                            <p>Just starting your English journey. Basic vocabulary and simple sentences.</p>
                        </div>
                        <div class="card" onclick="selectLevel('B1/B2')">
                            <h3>B1/B2 - Intermediate</h3>
                            <p>Can handle everyday situations. Growing vocabulary and complex sentences.</p>
                        </div>
                        <div class="card" onclick="selectLevel('IELTS')">
                            <h3>IELTS - Advanced</h3>
                            <p>Preparing for IELTS or advanced English proficiency. Complex topics and academic English.</p>
                        </div>
                    </div>
                </div>

                <!-- Variant Selection -->
                <div id="variantSelection" class="section">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">Choose Practice Variant</h2>
                    <div class="variant-selector">
                        <div class="card" onclick="selectVariant(1)">
                            <h3>Variant 1</h3>
                            <p>Complete practice test set</p>
                        </div>
                        <div class="card" onclick="selectVariant(2)">
                            <h3>Variant 2</h3>
                            <p>Complete practice test set</p>
                        </div>
                        <div class="card" onclick="selectVariant(3)">
                            <h3>Variant 3</h3>
                            <p>Complete practice test set</p>
                        </div>
                        <div class="card" onclick="selectVariant(4)">
                            <h3>Variant 4</h3>
                            <p>Complete practice test set</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="testInterface" class="main-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Test Sections</h2>
            <div class="sidebar-item" onclick="navigateToSection('Listening')" id="nav-Listening">
                üéß Listening
            </div>
            <div class="sidebar-item" onclick="navigateToSection('Reading')" id="nav-Reading">
                üìñ Reading
            </div>
            <div class="sidebar-item" onclick="navigateToSection('Writing')" id="nav-Writing">
                ‚úçÔ∏è Writing
            </div>
            <div class="sidebar-item" onclick="navigateToSection('Speaking')" id="nav-Speaking">
                üó£Ô∏è Speaking
            </div>
            <div class="sidebar-item" onclick="navigateToSection('Grammar')" id="nav-Grammar">
                üìù Grammar
            </div>
            <button class="nav-btn primary" onclick="showResults()" style="width: 100%; margin-top: 30px;">
                View Results
            </button>
            <button class="nav-btn" onclick="backToMainMenu()" style="width: 100%; margin-top: 10px; background: #95a5a6;">
                üè† Back to Menu
            </button>
        </div>

        <!-- Content -->
        <div class="content">
            <div class="container">
                <div id="testContent"></div>
            </div>
        </div>
    </div>

    <!-- Results -->
    <div id="resultsInterface" style="display: none;">
        <div class="content" style="margin-left: 0;">
            <div class="container">
                <h1>Your Assessment Results</h1>
                <p class="subtitle">Detailed Performance Analysis</p>
                
                <!-- Export Section -->
                <div class="export-section">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">üìÑ Export Results</h3>
                    <div class="export-fields">
                        <div class="field-group">
                            <label for="studentName">Student Name:</label>
                            <input type="text" id="studentName" placeholder="Enter student name...">
                        </div>
                        <div class="field-group">
                            <label for="testDescription">Description / Notes:</label>
                            <textarea id="testDescription" rows="3" placeholder="Add any notes or description..."></textarea>
                        </div>
                    </div>
                    <button class="export-btn" onclick="exportToWord()">
                        üì• Export to Word Document
                    </button>
                </div>
                
                <div id="resultsContent"></div>
                <button class="nav-btn primary" onclick="restartTest()">Take Another Test</button>
            </div>
        </div>
    </div>

    <script>
        let selectedLevel = '';
        let selectedVariant = 0;
        let currentSection = 'Listening';
        let answers = {};
        let completedSections = new Set();
        const sections = ['Listening', 'Reading', 'Writing', 'Speaking', 'Grammar'];

        const testData = {
            A0: {
                Listening: {
                    variants: {
                        1: {
                            // Variant 1: Jess, David, Tony - Favourite Rooms
                            videoUrl: 'https://drive.google.com/file/d/1jMDfH20kiqxCum768AATUtyITKgmBkfX/preview',
                            description: 'Listen to Jess, David, and Tony describing their favourite rooms',
                            questions: [
                                { q: 'What is Jess\'s favourite room?', type: 'mcq', options: ['The kitchen', 'The bedroom', 'The living room', 'The dining room'], correct: 1 },
                                { q: 'Jess\'s room is big and noisy.', type: 'tf', correct: false },
                                { q: 'What does Jess do at the desk every evening?', type: 'mcq', options: ['Watch TV', 'Play games', 'Study', 'Eat dinner'], correct: 2 },
                                { q: 'David\'s favourite room is the dining room.', type: 'tf', correct: true },
                                { q: 'How many chairs are in David\'s dining room?', type: 'mcq', options: ['Four', 'Five', 'Six', 'Eight'], correct: 2 },
                                { q: 'Where is David\'s old lamp from?', type: 'mcq', options: ['China', 'Japan', 'Turkey', 'France'], correct: 1 },
                                { q: 'David has a rug from Turkey on the floor.', type: 'tf', correct: true },
                                { q: 'How many rooms does Tony\'s apartment have?', type: 'mcq', options: ['One', 'Two', 'Three', 'Four'], correct: 0 },
                                { q: 'Where does Tony eat his meals?', type: 'mcq', options: ['At a table', 'On the bed', 'On the sofa', 'In the kitchen'], correct: 2 },
                                { q: 'Tony\'s room is on the ground floor.', type: 'tf', correct: false },
                                { q: 'What do Tony\'s friends like to do when they visit?', type: 'mcq', options: ['Watch movies', 'Play games', 'Cook food', 'Listen to music'], correct: 3 }
                            ]
                        },
                        2: {
                            // Variant 2: Marco & Lucia - Weekend in London
                            videoUrl: 'https://drive.google.com/file/d/1XH599NiuSQrQcuwV-7hwlvaNSzi5nGM8/preview',
                            description: 'Listen to Marco and Lucia talking about Lucia\'s weekend in London',
                            questions: [
                                { q: 'Where did Lucia go for the weekend?', type: 'mcq', options: ['Paris', 'London', 'Rome', 'Madrid'], correct: 1 },
                                { q: 'Lucia went to the carnival.', type: 'tf', correct: false },
                                { q: 'What show did Lucia see at the theatre?', type: 'mcq', options: ['Cats', 'Wicked', 'The Lion King', 'Mamma Mia'], correct: 2 },
                                { q: 'Lucia loved the songs in the show.', type: 'tf', correct: true },
                                { q: 'What did Lucia eat for dinner?', type: 'mcq', options: ['Pizza', 'Fish and chips', 'Pasta', 'Burger'], correct: 1 },
                                { q: 'Where was the restaurant?', type: 'mcq', options: ['In the city center', 'Next to the river', 'Near the theatre', 'At the hotel'], correct: 1 },
                                { q: 'What did Lucia and her boyfriend do on the boat?', type: 'mcq', options: ['Had dinner', 'Watched a movie', 'Danced', 'Slept'], correct: 2 },
                                { q: 'Lucia stayed at a hotel in London.', type: 'tf', correct: true },
                                { q: 'What did Lucia buy at the market?', type: 'mcq', options: ['A blue dress', 'A red jacket', 'Brown boots', 'A green scarf'], correct: 1 },
                                { q: 'Lucia\'s boots were a present from her dad.', type: 'tf', correct: true },
                                { q: 'What did Lucia have for lunch at the market?', type: 'mcq', options: ['Italian food', 'Chinese food', 'African food', 'Mexican food'], correct: 2 }
                            ]
                        },
                        3: {
                            // Variant 3: Lena, Paul, Holly - Transportation
                            videoUrl: 'https://drive.google.com/file/d/1UfcEVg2wGuE7BxmXFpwN6pfm-w3_hgCr/preview',
                            description: 'Listen to Lena, Paul, and Holly talking about how they travel',
                            questions: [
                                { q: 'Where does Lena live?', type: 'mcq', options: ['In the suburbs', 'In the city center', 'In a small town', 'In the countryside'], correct: 1 },
                                { q: 'How does Lena get to work?', type: 'mcq', options: ['By bus', 'By car', 'She walks', 'By subway'], correct: 2 },
                                { q: 'Lena often uses the bus.', type: 'tf', correct: false },
                                { q: 'How does Lena travel to other cities?', type: 'mcq', options: ['By car', 'By bus', 'By train', 'By plane'], correct: 2 },
                                { q: 'How far is Paul\'s work from his home?', type: 'mcq', options: ['5 miles', '10 miles', '15 miles', '20 miles'], correct: 1 },
                                { q: 'Paul goes to work on his scooter.', type: 'tf', correct: true },
                                { q: 'Why does Paul take the train for a night out?', type: 'mcq', options: ['It\'s cheaper', 'So he can drink', 'It\'s faster', 'He likes trains'], correct: 1 },
                                { q: 'How does Holly get to college?', type: 'mcq', options: ['By bus', 'By car', 'By bike', 'She walks'], correct: 2 },
                                { q: 'Why does Holly take the bus to the supermarket?', type: 'mcq', options: ['It\'s faster', 'She doesn\'t have a bike', 'So she doesn\'t carry heavy bags', 'It\'s cheaper'], correct: 2 },
                                { q: 'Holly can drive a car.', type: 'tf', correct: false },
                                { q: 'Holly never takes taxis because they are too expensive.', type: 'tf', correct: true }
                            ]
                        },
                        4: {
                            // Variant 4: Sophie - Trip to Egypt
                            videoUrl: 'https://drive.google.com/file/d/1_bpjVz44vt4g56LvBKmhgumhDd3LRwIV/preview',
                            description: 'Listen to Sophie talking about her trip to Egypt',
                            questions: [
                                { q: 'Where did Sophie go on holiday?', type: 'mcq', options: ['Turkey', 'Greece', 'Egypt', 'Morocco'], correct: 2 },
                                { q: 'Sophie usually goes on holiday in Britain.', type: 'tf', correct: true },
                                { q: 'Did Sophie travel with a friend?', type: 'mcq', options: ['Yes, with her best friend', 'Yes, with her sister', 'No, she went alone', 'Yes, with her boyfriend'], correct: 2 },
                                { q: 'Where did Sophie stay?', type: 'mcq', options: ['In expensive hotels', 'In guest houses', 'With friends', 'In a tent'], correct: 1 },
                                { q: 'Sophie thought the guest houses were nicer than hotels.', type: 'tf', correct: true },
                                { q: 'What did Sophie eat on the first night?', type: 'mcq', options: ['Local food from the market', 'Food at a European restaurant', 'Food at the guest house', 'Fast food'], correct: 1 },
                                { q: 'Sophie got sick during her trip.', type: 'tf', correct: true },
                                { q: 'How long was Sophie sick?', type: 'mcq', options: ['A few hours', 'One day', 'Three days', 'A week'], correct: 1 },
                                { q: 'What did Sophie enjoy most?', type: 'mcq', options: ['The historic sites', 'The local food', 'Boat trips on the River Nile', 'Shopping at markets'], correct: 2 },
                                { q: 'The historic sites were very quiet.', type: 'tf', correct: false },
                                { q: 'Sophie liked the sunsets on the river.', type: 'tf', correct: true }
                            ]
                        }
                    }
                },
                Reading: {
                    text: 'My name is Tom. I am 25 years old. I live in a small house with my cat. My cat is black and white. Her name is Lily. Every day, I wake up at 7 AM. I eat breakfast with Lily. Then I go to work. I work in a school. I teach children. I love my job. After work, I come home and play with Lily. We are very happy.',
                    questions: [
                        { q: 'Tom is 25 years old.', type: 'tf', correct: true },
                        { q: 'What color is the cat?', type: 'mcq', options: ['All black', 'Black and white', 'Brown', 'White'], correct: 1 },
                        { q: "Complete the sentence: The cat's name is ___", type: 'sentence', stem: "The cat's name is", answer: 'Lily' },
                        { q: 'Tom teaches adults.', type: 'tf', correct: false },
                        { q: 'What time does Tom wake up?', type: 'short', correct: '7' },
                        { q: 'Match: Tom works in a ___', type: 'sentence', stem: 'Tom works in a', answer: 'school' }
                    ]
                },
                Writing: {
                    task1: 'Translate to English: –ú–µ–Ω—è –∑–æ–≤—É—Ç [your name]. –ú–Ω–µ [age] –ª–µ—Ç. –Ø –∂–∏–≤—É –≤ [city].',
                    task2: 'Write 3-5 sentences about your family.',                },
                Speaking: {
                    part1: ['What is your name?', 'Where do you live?', 'Do you have pets?', 'What is your favorite color?'],
                    part2: 'Describe your best friend. You should say: their name, how you met, what they look like, and why you like them.',
                    instruction: 'Prepare your answers mentally or record yourself speaking. This helps evaluate your speaking fluency.'
                },
                Grammar: [
                    { q: 'I ___ a student.', type: 'mcq', options: ['am', 'is', 'are', 'be'], correct: 0, topic: 'Verb To Be - Present Simple' },
                    { q: 'She ___ to school every day.', type: 'mcq', options: ['go', 'goes', 'going', 'went'], correct: 1, topic: 'Present Simple - Third Person' },
                    { q: 'Translate: –Ø –ª—é–±–ª—é —á–∏—Ç–∞—Ç—å –∫–Ω–∏–≥–∏.', type: 'short', correct: 'I love reading books', topic: 'Basic Translation' },
                    { q: 'They ___ playing football.', type: 'mcq', options: ['is', 'am', 'are', 'be'], correct: 2, topic: 'Verb To Be - Plural' },
                    { q: 'Choose the correct: Yesterday I ___ to the park.', type: 'mcq', options: ['go', 'goes', 'went', 'going'], correct: 2, topic: 'Past Simple' },
                    { q: 'My brother ___ tall.', type: 'mcq', options: ['am', 'is', 'are', 'be'], correct: 1, topic: 'Verb To Be - Singular' },
                    { q: 'Complete: I ___ a dog.', type: 'sentence', stem: 'I', answer: 'have', topic: 'Verb Have' },
                    { q: 'We ___ English every day.', type: 'mcq', options: ['study', 'studies', 'studying', 'studied'], correct: 0, topic: 'Present Simple' },
                    { q: '___ you like pizza?', type: 'mcq', options: ['Do', 'Does', 'Is', 'Are'], correct: 0, topic: 'Questions - Present Simple' },
                    { q: 'She ___ watching TV now.', type: 'mcq', options: ['am', 'is', 'are', 'be'], correct: 1, topic: 'Present Continuous' }
                ]
            },
            'B1/B2': {
                Listening: {
                    variants: {
                        1: {
                            // Variant 1: Money Management - Joseph, Taylor, Dina, Liam, Ben, Sophie
                            videoUrl: 'https://drive.google.com/file/d/1QL5mDv49MDnOYqZeNzGcd_-gZm1EDxi2/preview',
                            description: 'Listen to six people talking about money and financial situations',
                            questions: [
                                // Joseph
                                { q: 'What is Joseph saving money for?', type: 'mcq', options: ['A car', 'A bike', 'A house', 'A holiday'], correct: 1 },
                                { q: 'Joseph works as a waiter.', type: 'tf', correct: true },
                                { q: 'Joseph wants to take a loan to buy his bike.', type: 'tf', correct: false },
                                // Taylor
                                { q: 'How does Taylor pay for things nowadays?', type: 'mcq', options: ['Cash only', 'Cheques', 'Cards exclusively', 'A mix of cash and cards'], correct: 2 },
                                { q: 'According to Taylor, even street performers in London have card readers.', type: 'tf', correct: true },
                                // Dina
                                { q: 'Why couldn\'t Dina\'s friend afford her rent?', type: 'mcq', options: ['She lost her job', 'She had medical expenses', 'She bought a car', 'She went on holiday'], correct: 1 },
                                { q: 'Dina let her friend get a bank loan.', type: 'tf', correct: false },
                                // Liam
                                { q: 'What takes up a big part of Liam\'s salary?', type: 'mcq', options: ['Car payments', 'Mortgage payments', 'Student loans', 'Credit card debt'], correct: 1 },
                                { q: 'Liam often goes out for dinner with friends.', type: 'tf', correct: false },
                                // Ben
                                { q: 'What did Ben have to pay for unexpectedly?', type: 'mcq', options: ['Medical bills', 'Car repair', 'Home repair', 'Legal fees'], correct: 1 },
                                { q: 'Ben paid for the repair with his savings.', type: 'tf', correct: false },
                                // Sophie
                                { q: 'What happened when Sophie\'s cousin asked for more money?', type: 'mcq', options: ['Sophie gave it to her', 'Sophie said no', 'Sophie asked for interest', 'Sophie ignored her'], correct: 1 },
                                { q: 'Sophie thinks mixing money with family is a good idea.', type: 'tf', correct: false }
                            ]
                        },
                        2: {
                            // Variant 2: How Do You Travel to Work? - Piers, Sydney, Brenda, Nick
                            videoUrl: 'https://drive.google.com/file/d/1nv7Z9E-AK7BxcJ-vU013dJOFwkMlT1DC/preview',
                            description: 'Listen to four people describing how they travel to work',
                            questions: [
                                // Piers
                                { q: 'How does Piers start his journey to work?', type: 'mcq', options: ['By car', 'By bus', 'By train', 'By bike'], correct: 1 },
                                { q: 'Piers can usually find a seat on the bus.', type: 'tf', correct: false },
                                { q: 'What does Piers do before getting on the tube?', type: 'mcq', options: ['Reads a book', 'Grabs a coffee', 'Makes phone calls', 'Exercises'], correct: 1 },
                                { q: 'Piers thinks the underground feels warm and personal.', type: 'tf', correct: false },
                                // Sydney
                                { q: 'What does Sydney drive to work?', type: 'mcq', options: ['A car', 'A van', 'A motorcycle', 'A truck'], correct: 1 },
                                { q: 'How long is Sydney\'s journey to work?', type: 'mcq', options: ['15 minutes', '25 minutes', '35 minutes', '45 minutes'], correct: 2 },
                                { q: 'Sydney sometimes slows down to make the drive last longer.', type: 'tf', correct: true },
                                // Brenda
                                { q: 'Where does Brenda live?', type: 'mcq', options: ['London', 'New York', 'Amsterdam', 'Paris'], correct: 2 },
                                { q: 'What transport does Brenda use daily?', type: 'mcq', options: ['Car and train', 'Bicycle and ferry', 'Bus and tram', 'Motorcycle and boat'], correct: 1 },
                                { q: 'Brenda found cycling in New York peaceful and safe.', type: 'tf', correct: false },
                                // Nick
                                { q: 'How long is Nick\'s commute each way?', type: 'mcq', options: ['30 minutes', '45 minutes', 'Over an hour', '2 hours'], correct: 2 },
                                { q: 'What does Nick do during his commute now?', type: 'mcq', options: ['Sleeps', 'Listens to podcasts and audiobooks', 'Works on his laptop', 'Watches movies'], correct: 1 },
                                { q: 'Nick is learning French during his commute.', type: 'tf', correct: true }
                            ]
                        },
                        3: {
                            // Variant 3: Living with Your Ex After a Break-up - Maria
                            videoUrl: 'https://drive.google.com/file/d/17PdGGXU7TimjjkQKV_TYdEfO4gkf_gtn/preview',
                            description: 'Listen to Maria talking about living with her ex-boyfriend after their break-up',
                            questions: [
                                { q: 'Who decided to end the relationship?', type: 'mcq', options: ['Adam', 'Maria', 'Both of them', 'Their friends'], correct: 1 },
                                { q: 'Why couldn\'t Maria move out immediately?', type: 'mcq', options: ['She didn\'t want to', 'They couldn\'t afford it', 'Adam asked her to stay', 'The landlord refused'], correct: 1 },
                                { q: 'Where did Maria move to within the apartment?', type: 'mcq', options: ['The living room', 'The guest bedroom', 'A storage room', 'The kitchen'], correct: 2 },
                                { q: 'Maria had very few clothes so storage was easy.', type: 'tf', correct: false },
                                { q: 'What did Maria do after having a rough day at school?', type: 'mcq', options: ['Called her mother', 'Turned to Adam for comfort', 'Went out with friends', 'Stayed in her room'], correct: 1 },
                                { q: 'Maria and Adam agreed not to date anyone else while living together.', type: 'tf', correct: true },
                                { q: 'How did Adam find out about Maria\'s new romantic interest?', type: 'mcq', options: ['Maria told him directly', 'He read her messages', 'He overheard her conversation', 'A friend told him'], correct: 2 },
                                { q: 'What did Adam do after finding out about the other guy?', type: 'mcq', options: ['He cried', 'He moved out', 'He brought a girl home', 'He forgave Maria'], correct: 2 },
                                { q: 'How long did Maria stay in the apartment?', type: 'mcq', options: ['Three months', 'Six months', 'One year', 'Two years'], correct: 1 },
                                { q: 'Maria\'s friendship with Sarah remained strong after she moved out.', type: 'tf', correct: false },
                                { q: 'Maria believes she should have moved out sooner.', type: 'tf', correct: true }
                            ]
                        },
                        4: {
                            // Variant 4: Albert Einstein Biography
                            videoUrl: 'https://drive.google.com/file/d/1DtlezkmsTeQuC-uSKkuC46h8e5DnaTUL/preview',
                            description: 'Listen to a biography of Albert Einstein',
                            questions: [
                                { q: 'Where was Albert Einstein born?', type: 'mcq', options: ['Munich, Germany', 'Ulm, Germany', 'Bern, Switzerland', 'Milan, Italy'], correct: 1 },
                                { q: 'Einstein easily found academic employment after graduating.', type: 'tf', correct: false },
                                { q: 'What job did Einstein have in 1902?', type: 'mcq', options: ['Professor', 'Patent clerk', 'Researcher', 'Teacher'], correct: 1 },
                                { q: 'Which year is called Einstein\'s "miracle year"?', type: 'mcq', options: ['1902', '1905', '1915', '1921'], correct: 1 },
                                { q: 'Who experimentally confirmed general relativity in 1919?', type: 'mcq', options: ['Max Planck', 'Niels Bohr', 'Sir Arthur Eddington', 'Werner Heisenberg'], correct: 2 },
                                { q: 'Einstein won the Nobel Prize for his work on relativity.', type: 'tf', correct: false },
                                { q: 'Why did Einstein leave Germany in 1933?', type: 'mcq', options: ['For a better job', 'He was driven out by the Nazis', 'His wife wanted to move', 'For health reasons'], correct: 1 },
                                { q: 'Einstein became a U.S. citizen in 1940.', type: 'tf', correct: true },
                                { q: 'What position was Einstein offered but turned down?', type: 'mcq', options: ['Director of NASA', 'President of Israel', 'Head of the UN', 'Prime Minister of Germany'], correct: 1 },
                                { q: 'What did Einstein famously do when confronted by paparazzi?', type: 'mcq', options: ['Ran away', 'Covered his face', 'Stuck out his tongue', 'Smiled politely'], correct: 2 },
                                { q: 'According to the passage, Einstein\'s work has no impact on modern technology.', type: 'tf', correct: false }
                            ]
                        }
                    }
                },
                Reading: {
                    text: 'Climate change represents one of the most significant challenges facing humanity today. Rising global temperatures have led to melting ice caps, rising sea levels, and increasingly frequent extreme weather events. Scientists warn that without immediate action, the consequences could be catastrophic. However, there is still hope. Many countries are transitioning to renewable energy sources, and individuals are making more environmentally conscious decisions. The question is not whether we can make a difference, but whether we will act quickly enough to prevent the worst outcomes.',
                    questions: [
                        { q: 'What is the main idea of this passage?', type: 'mcq', options: ['Climate change is unsolvable', 'Climate change requires urgent action', 'Climate change is not real', 'Climate change only affects animals'], correct: 1 },
                        { q: 'Match the information: Rising temperatures cause ___', type: 'match', pairs: [['melting ice', 'polar regions'], ['sea level rise', 'coastal areas'], ['extreme weather', 'global impact']], correctPairs: [['melting ice', 'polar regions'], ['sea level rise', 'coastal areas']] },
                        { q: 'The author believes the situation is hopeless.', type: 'tf', correct: false },
                        { q: 'Complete: Many countries are transitioning to ___ energy sources.', type: 'sentence', stem: 'Many countries are transitioning to', answer: 'renewable' },
                        { q: 'According to the writer, what is the key question?', type: 'short', correct: 'whether we will act quickly enough' },
                        { q: 'What claim does the author make about individuals?', type: 'views', statement: 'Individuals are making environmentally conscious decisions', answer: 'yes' }
                    ]
                },
                Writing: {
                    variants: {
                        1: {
                            task1: 'The diagram below shows how rainwater is collected for the use of drinking water in an Australian town. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write an essay plan (introduction, 2 body paragraphs, conclusion) for: "Some people believe technology makes us less social. To what extent do you agree or disagree?"',
                            chartUrl: 'https://drive.google.com/thumbnail?id=1LJRKA69IaURz9NjuUC1on0jn2By3KTxD&sz=w800'
                        },
                        2: {
                            task1: 'The table below gives information about the employment sectors in which people from 3 age groups worked. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write an essay plan (introduction, 2 body paragraphs, conclusion) for: "In many countries, young people are choosing to work abroad rather than in their home country. What are the advantages and disadvantages of this trend?"',
                            chartUrl: 'https://drive.google.com/thumbnail?id=1w5j2MDRZT7OlGNWmeRQI6Pj2HiIcS_t_&sz=w800'
                        },
                        3: {
                            task1: 'The graph below shows the consumption of three kinds of spreads (margarine, low fat & reduced spreads, and butter) between 1981 and 2007. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write an essay plan (introduction, 2 body paragraphs, conclusion) for: "Many people believe that social media has a negative impact on mental health. To what extent do you agree or disagree?"',
                            chartUrl: 'https://drive.google.com/thumbnail?id=18ulG8oe9F095VCkJD-t6NA1hAv6UJXbE&sz=w800'
                        },
                        4: {
                            task1: 'The diagram shows the consumption of renewable energy in the USA from 1949-2008. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write an essay plan (introduction, 2 body paragraphs, conclusion) for: "Some people think that governments should invest more in public transportation. Others believe the money should be spent on building more roads. Discuss both views and give your opinion."',
                            chartUrl: 'https://drive.google.com/thumbnail?id=1-KGaAh7WYEp2dsFjMolXtG-epACmKloM&sz=w800'
                        }
                    }
                },
                Speaking: {
                    part1: ['What do you do in your free time?', 'Do you prefer city or countryside living? Why?', 'How important is education in your country?', 'What are your career goals?'],
                    part2: 'Describe a memorable journey you have taken. You should say: where you went, who you went with, what you did there, and why it was memorable.',
                    instruction: 'Practice speaking your answers aloud. Time yourself: Part 1 (4-5 min), Part 2 (2 min speaking + 1 min prep)'
                },
                Grammar: [
                    { q: 'If I ___ more time, I would travel the world.', type: 'mcq', options: ['have', 'had', 'has', 'having'], correct: 1, topic: 'Second Conditional' },
                    { q: 'The report ___ by the manager yesterday.', type: 'mcq', options: ['writes', 'wrote', 'was written', 'has written'], correct: 2, topic: 'Passive Voice - Past Simple' },
                    { q: 'She has been working here ___ 2015.', type: 'mcq', options: ['for', 'since', 'from', 'at'], correct: 1, topic: 'Present Perfect Continuous - Time Prepositions' },
                    { q: 'I wish I ___ speak French.', type: 'mcq', options: ['can', 'could', 'will', 'would'], correct: 1, topic: 'Wish + Past Simple' },
                    { q: 'By next year, they ___ the project.', type: 'mcq', options: ['complete', 'completed', 'will have completed', 'are completing'], correct: 2, topic: 'Future Perfect' },
                    { q: 'Complete: If I had known, I ___ you.', type: 'sentence', stem: 'If I had known, I', answer: 'would have told', topic: 'Third Conditional' },
                    { q: 'Neither of the students ___ finished the test.', type: 'mcq', options: ['have', 'has', 'are', 'is'], correct: 1, topic: 'Subject-Verb Agreement - Neither' },
                    { q: 'She suggested ___ to the cinema.', type: 'mcq', options: ['go', 'to go', 'going', 'gone'], correct: 2, topic: 'Gerunds after Suggest' },
                    { q: 'The book, ___ I bought yesterday, is fascinating.', type: 'mcq', options: ['who', 'which', 'where', 'when'], correct: 1, topic: 'Relative Clauses - Which' },
                    { q: '___ the difficulties, they succeeded.', type: 'mcq', options: ['Despite', 'Although', 'Because', 'If'], correct: 0, topic: 'Contrast - Despite vs Although' },
                    { q: 'Translate: –ï—Å–ª–∏ –±—ã —è –∑–Ω–∞–ª –æ—Ç–≤–µ—Ç, —è –±—ã —Ç–µ–±–µ —Å–∫–∞–∑–∞–ª.', type: 'short', correct: 'If I had known the answer, I would have told you', topic: 'Third Conditional Translation' }
                ]
            },
            IELTS: {
                Listening: {
                    variants: {
                        1: {
                            // Variant 1: The Benefits of a Bilingual Brain
                            videoUrl: 'https://drive.google.com/file/d/1nwa9Ma3qbUHRZNmh2UyRemGYMcOg4hOC/preview',
                            description: 'Listen to a talk about how bilingualism affects the brain',
                            questions: [
                                { q: 'According to the video, most people in the world are:', type: 'mcq', options: ['Monolingual', 'Bilingual or multilingual', 'Trilingual', 'Language learners'], correct: 1 },
                                { q: 'Language ability is measured in how many skills?', type: 'mcq', options: ['Two', 'Three', 'Four', 'Five'], correct: 2 },
                                { q: 'A balanced bilingual has equal abilities in all skills in two languages.', type: 'tf', correct: true },
                                { q: 'What type of bilingual is Gabriella (who immigrated at age 2)?', type: 'mcq', options: ['Coordinate bilingual', 'Compound bilingual', 'Subordinate bilingual', 'Sequential bilingual'], correct: 1 },
                                { q: 'Subordinate bilinguals learn a second language by filtering it through their primary language.', type: 'tf', correct: true },
                                { q: 'Which brain hemisphere is typically more dominant in logical processes?', type: 'mcq', options: ['Right hemisphere', 'Left hemisphere', 'Both equally', 'Neither'], correct: 1 },
                                { q: 'According to the critical period hypothesis, children learn languages more easily because:', type: 'mcq', options: ['They have more free time', 'Their brains are more plastic', 'They are more motivated', 'They have better teachers'], correct: 1 },
                                { q: 'Research shows that adult second-language learners often exhibit less emotional bias when problem-solving in their second language.', type: 'tf', correct: true },
                                { q: 'What physically visible advantage do bilingual brains have?', type: 'mcq', options: ['Larger brain size', 'Higher density of gray matter', 'More blood vessels', 'Thicker skull'], correct: 1 },
                                { q: 'Bilingualism can delay Alzheimer\'s and dementia by how many years?', type: 'mcq', options: ['Two years', 'Three years', 'Five years', 'Ten years'], correct: 2 },
                                { q: 'Before the 1960s, bilingualism was considered an advantage for child development.', type: 'tf', correct: false },
                                { q: 'Which brain region is strengthened by switching between languages?', type: 'mcq', options: ['Hippocampus', 'Cerebellum', 'Dorsolateral prefrontal cortex', 'Amygdala'], correct: 2 },
                                { q: 'The dorsolateral prefrontal cortex plays a key role in:', type: 'mcq', options: ['Memory storage', 'Executive function and problem-solving', 'Emotional responses', 'Motor control'], correct: 1 },
                                { q: 'According to the video, bilingualism definitely makes you smarter.', type: 'tf', correct: false }
                            ]
                        },
                        2: {
                            // Variant 2: North Korea - South Korea Tensions (News Report)
                            videoUrl: 'https://drive.google.com/file/d/1BuVKY3KmAyLjgYHPLQvEVZMz3op329FL/preview',
                            description: 'Listen to a news report about tensions between North and South Korea',
                            questions: [
                                { q: 'What are protesters in South Korea calling for?', type: 'mcq', options: ['Peace talks', 'UN and international community to punish North Korea', 'Removal of US troops', 'New elections'], correct: 1 },
                                { q: 'What triggered the escalation of tensions between the two Koreas?', type: 'mcq', options: ['A missile launch', 'Anti-North Korean propaganda broadcasts', 'A naval attack', 'A cyber attack'], correct: 1 },
                                { q: 'What happened in the demilitarized zone that Seoul blames Pyongyang for?', type: 'mcq', options: ['A shooting', 'A bombing', 'A landmine explosion', 'A kidnapping'], correct: 2 },
                                { q: 'Two South Korean border guards were killed in the incident.', type: 'tf', correct: false },
                                { q: 'Kim Jong-un called the loudspeaker broadcasts:', type: 'mcq', options: ['An act of war', 'Psychological warfare', 'A minor annoyance', 'Illegal activity'], correct: 1 },
                                { q: 'How long did Kim give South Korea to shut down the loudspeakers?', type: 'mcq', options: ['24 hours', '48 hours', '72 hours', 'One week'], correct: 1 },
                                { q: 'Kim Jong-un is known for making empty, theatrical threats.', type: 'tf', correct: true },
                                { q: 'What have the two sides already exchanged?', type: 'mcq', options: ['Missiles', 'Warning shots', 'Prisoners', 'Diplomats'], correct: 1 },
                                { q: 'Where have residents near the border been forced to go?', type: 'mcq', options: ['To hospitals', 'To other cities', 'Into shelters', 'Across the border'], correct: 2 },
                                { q: 'What has South Korea\'s president ordered troops to do if attacked?', type: 'mcq', options: ['Retreat', 'Call for help', 'Retaliate', 'Surrender'], correct: 2 },
                                { q: 'Both the United States and the United Nations have called for calm.', type: 'tf', correct: true },
                                { q: 'What will the U.S. Army continue with the South Korean military?', type: 'mcq', options: ['Peace negotiations', 'Annual training exercises', 'Border patrols', 'Weapon sales'], correct: 1 },
                                { q: 'North Korea supports the presence of US military exercises near its border.', type: 'tf', correct: false },
                                { q: 'Who reported this news story?', type: 'mcq', options: ['CNN', 'BBC', 'CBC News', 'Al Jazeera'], correct: 2 }
                            ]
                        },
                        3: {
                            // Variant 3: Illegal Wildlife Trade in Thailand (News Report)
                            videoUrl: 'https://drive.google.com/file/d/1ewXxr8XktJRFR08Et7VnjeYfqqOJuD9o/preview',
                            description: 'Listen to a news report about illegal wildlife trade in Thailand',
                            questions: [
                                { q: 'What animals were seized that were ready for export?', type: 'mcq', options: ['Tigers', 'Elephants', 'Pangolins', 'Monkeys'], correct: 2 },
                                { q: 'Where were the pangolins likely being sent?', type: 'mcq', options: ['Japan', 'China', 'Vietnam', 'Indonesia'], correct: 1 },
                                { q: 'How many pangolins were seized?', type: 'mcq', options: ['73', '137', '173', '317'], correct: 2 },
                                { q: 'What was the estimated value of the seized pangolins?', type: 'mcq', options: ['$30,000', '$100,000', 'More than $300,000', '$1 million'], correct: 2 },
                                { q: 'The kingpins behind the illegal wildlife trade are frequently caught.', type: 'tf', correct: false },
                                { q: 'Thailand serves as a major hub for illegal wildlife trade in which region?', type: 'mcq', options: ['East Asia', 'Southeast Asia', 'South Asia', 'Central Asia'], correct: 1 },
                                { q: 'What is the name of the market that has become the center of Bangkok\'s illegal wildlife trade?', type: 'mcq', options: ['Chatuchak Market', 'Floating Market', 'Night Market', 'Central Market'], correct: 0 },
                                { q: 'What endangered animal was shown being easily purchased with a hidden camera?', type: 'mcq', options: ['Pangolin', 'Star tortoise', 'Snow leopard', 'Red panda'], correct: 1 },
                                { q: 'Where is the star tortoise mainly found?', type: 'mcq', options: ['China and Japan', 'India and Sri Lanka', 'Thailand and Vietnam', 'Indonesia and Malaysia'], correct: 1 },
                                { q: 'Police conduct regular raids at the market.', type: 'tf', correct: true },
                                { q: 'What problem do police face when patrolling the market too often?', type: 'mcq', options: ['They get tired', 'Traffickers recognize them and hide animals', 'The market closes', 'They run out of funding'], correct: 1 },
                                { q: 'What often happens to offenders under Thai law?', type: 'mcq', options: ['Long prison sentences', 'They escape with a fine', 'Deportation', 'Community service'], correct: 1 },
                                { q: 'How do traffickers often justify selling endangered species?', type: 'mcq', options: ['They have permits', 'They claim the animals were bred in captivity', 'They say they are rescuing them', 'They deny the animals are endangered'], correct: 1 },
                                { q: 'How long ago was a stronger wildlife protection law drafted?', type: 'mcq', options: ['Two years', 'Five years', 'Eight years', 'Ten years'], correct: 2 },
                                { q: 'The stronger wildlife protection law has been passed by Parliament.', type: 'tf', correct: false }
                            ]
                        },
                        4: {
                            // Variant 4: University Accommodation Experiences - Jennie, Ben, Joseph
                            videoUrl: 'https://drive.google.com/file/d/13U2G3BY0Ft6juoRN65nlNt2xHl6Vr_ab/preview',
                            description: 'Listen to three people talking about their university accommodation experiences',
                            questions: [
                                // Jennie
                                { q: 'Who paid for Jennie\'s first year accommodation?', type: 'mcq', options: ['Jennie herself', 'Her parents', 'A scholarship', 'Student loan'], correct: 1 },
                                { q: 'What type of hall was Jennie placed in?', type: 'mcq', options: ['Mixed hall', 'All-male hall', 'All-female hall', 'Postgraduate hall'], correct: 2 },
                                { q: 'Jennie was happy with being placed in an all-female hall.', type: 'tf', correct: false },
                                { q: 'Where was Jennie\'s room located in the building?', type: 'mcq', options: ['Top floor', 'Ground floor', 'Basement level', 'Second floor'], correct: 2 },
                                { q: 'What did Jennie have to take care of herself?', type: 'mcq', options: ['Meals and laundry', 'Only laundry', 'Only meals', 'Nothing'], correct: 1 },
                                { q: 'Jennie was very sociable and made many friends at mealtimes.', type: 'tf', correct: false },
                                // Ben
                                { q: 'How did Ben feel about moving away from home?', type: 'mcq', options: ['Nervous', 'Excited and couldn\'t wait', 'Indifferent', 'Sad'], correct: 1 },
                                { q: 'What was Ben\'s hall of residence next to?', type: 'mcq', options: ['The library', 'The student bar', 'The sports center', 'The main building'], correct: 1 },
                                { q: 'Ben cooked proper meals regularly.', type: 'tf', correct: false },
                                { q: 'What did Ben do when he ran out of clean clothes?', type: 'mcq', options: ['Did laundry', 'Went home to his mum', 'Wore dirty clothes', 'Bought more clothes'], correct: 3 },
                                { q: 'Ben regrets how he lived at university.', type: 'tf', correct: false },
                                // Joseph
                                { q: 'Why did Joseph choose a shared house over halls of residence?', type: 'mcq', options: ['It was cheaper', 'He thought it would be quieter', 'His friends lived there', 'It had better facilities'], correct: 1 },
                                { q: 'How many people lived in Joseph\'s shared house?', type: 'mcq', options: ['Four', 'Five', 'Six', 'Seven'], correct: 2 },
                                { q: 'Joseph got along well with his housemates.', type: 'tf', correct: false },
                                { q: 'What problems did Joseph have with his housemates?', type: 'mcq', options: ['They were too quiet', 'They were noisy, had parties, and smoked', 'They never paid rent', 'They ate his food'], correct: 1 },
                                { q: 'Joseph almost quit his university course because of his accommodation.', type: 'tf', correct: true },
                                { q: 'Where did Joseph end up living for the rest of the year?', type: 'mcq', options: ['Back home with parents', 'In halls of residence', 'Lodging with an elderly woman', 'In a different shared house'], correct: 2 },
                                { q: 'What did Gladys make for Joseph every week?', type: 'mcq', options: ['Dinner', 'A cake', 'Breakfast', 'Sandwiches'], correct: 1 }
                            ]
                        }
                    }
                },
                Reading: {
                    text: 'The phenomenon of urbanization has dramatically reshaped human civilization over the past two centuries. What began as a gradual migration from rural areas to cities during the Industrial Revolution has accelerated into a global trend, with over half of the world\'s population now residing in urban environments. This shift has profound implications for economic development, social structures, and environmental sustainability. Cities serve as engines of innovation and economic growth, concentrating resources, talent, and opportunities in ways that rural areas cannot match. However, rapid urbanization also presents significant challenges, including overcrowding, pollution, inequality, and strain on infrastructure. The success of future urban development will depend on our ability to create sustainable, inclusive cities that balance economic prosperity with social equity and environmental stewardship. Urban planners face the complex task of designing spaces that accommodate growing populations while preserving quality of life. Some experts argue that vertical expansion and green architecture offer viable solutions, while others advocate for decentralized urban networks. The debate continues, but one thing remains clear: the urban century demands innovative thinking and collaborative action.',
                    questions: [
                        { q: 'What is the main theme of this passage?', type: 'mcq', options: ['Rural decline', 'Urban transformation and challenges', 'Industrial history', 'Environmental destruction'], correct: 1 },
                        { q: 'Match information: Urban benefits include ___', type: 'match', pairs: [['Economic', 'innovation hubs'], ['Social', 'diverse opportunities'], ['Infrastructure', 'resource concentration']], correctPairs: [['Economic', 'innovation hubs'], ['Social', 'diverse opportunities']] },
                        { q: 'Identify the writer\'s claim: Cities are exclusively positive for development.', type: 'views', statement: 'Cities are exclusively positive', answer: 'no' },
                        { q: 'Complete: Future success depends on creating ___ cities.', type: 'sentence', stem: 'Future success depends on creating', answer: 'sustainable, inclusive' },
                        { q: 'According to the passage, what percentage of people live in urban areas?', type: 'short', correct: 'over half' },
                        { q: 'The author presents urbanization as entirely negative.', type: 'tf', correct: false },
                        { q: 'Match features: Solutions mentioned include ___', type: 'match', pairs: [['Vertical expansion', 'building upward'], ['Green architecture', 'sustainable design'], ['Decentralized networks', 'distributed cities']], correctPairs: [['Vertical expansion', 'building upward'], ['Green architecture', 'sustainable design']] },
                        { q: 'What does the author suggest about urban planning?', type: 'short', correct: 'requires innovative thinking' }
                    ]
                },
                Writing: {
                    variants: {
                        1: {
                            task1: 'The line and bar charts below show information about visits to and from the UK from 1979 to 1999, and the most popular countries visited by UK residents in 1999. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write a complete essay: "In many countries, the gap between rich and poor is widening. What problems does this cause and what solutions can you suggest?" Include: paraphrased thesis, 2 problems with examples, 2 solutions with support, conclusion.',
                            chartUrl: 'https://drive.google.com/thumbnail?id=1u-oUFhn9UQl7s9vPXDu8YhFsl4BTnYkA&sz=w800'
                        },
                        2: {
                            task1: 'The pie and bar charts below show the percentage of persons arrested in the five years ending 1994 and the most recent reasons for arrest. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write a complete essay: "Some people believe that criminals should be punished with lengthy prison sentences, while others argue that rehabilitation and community service are more effective. Discuss both views and give your opinion."',
                            chartUrl: 'https://drive.google.com/thumbnail?id=1LcDa2WAuJLysmO3J5RDWrmDveblKWptQ&sz=w800'
                        },
                        3: {
                            task1: 'The pie charts below show information about Public Sector Employment in 2015 and 2020. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write a complete essay: "Government spending on public services has increased significantly in recent years. Some people think this is a positive development, while others believe it leads to inefficiency. Discuss both views and give your opinion."',
                            chartUrl: 'https://drive.google.com/thumbnail?id=1x0zCwdyZRh4di7zXGqfD8apbmVtFCpIJ&sz=w800'
                        },
                        4: {
                            task1: 'The maps below show the development of the village of Ryemouth between 1995 and present. Summarise the information by selecting and reporting the main features, and make comparisons where relevant.',
                            task2: 'Write a complete essay: "Many towns and cities are changing rapidly due to urban development. What are the advantages and disadvantages of such changes for local communities?"',
                            chartUrl: 'https://drive.google.com/thumbnail?id=11Mbu_QZIwy2uouCys4j8gMBRifc413aG&sz=w800'
                        }
                    }
                },
                Speaking: {
                    part1: ['How has your hometown changed in recent years?', 'What role does technology play in your daily life?', 'Do you think work-life balance is important? Why?', 'What are your views on lifelong learning?'],
                    part2: 'Describe a person who has influenced your thinking. You should say: who this person is, how you know them, what ideas they have shared, and explain how they have influenced you.',
                    part3: ['How do cultural values shape individual behavior?', 'To what extent should governments regulate personal choices?', 'What are the long-term implications of increasing globalization?', 'How can societies balance tradition with modernization?'],
                    instruction: 'Practice speaking naturally. Part 1 (4-5 min), Part 2 (2 min + 1 min prep), Part 3 (4-5 min discussion)'
                },
                Grammar: [
                    { q: 'Scarcely ___ arrived when the meeting started.', type: 'mcq', options: ['I have', 'have I', 'had I', 'I had'], correct: 2, topic: 'Inversion - Scarcely/Hardly' },
                    { q: 'The committee has requested that the proposal ___ revised.', type: 'mcq', options: ['is', 'be', 'will be', 'would be'], correct: 1, topic: 'Subjunctive Mood' },
                    { q: 'Not only ___ the deadline, but they also exceeded expectations.', type: 'mcq', options: ['they met', 'did they meet', 'they have met', 'have they met'], correct: 1, topic: 'Inversion - Not only' },
                    { q: 'Were it not for your assistance, I ___ the project.', type: 'mcq', options: ['cannot complete', 'could not complete', 'could not have completed', 'cannot have completed'], correct: 2, topic: 'Mixed Conditional with Inversion' },
                    { q: 'The findings, ___ were unexpected, warrant further investigation.', type: 'mcq', options: ['that', 'which', 'who', 'what'], correct: 1, topic: 'Non-defining Relative Clauses' },
                    { q: 'She objected to ___ treated unfairly.', type: 'mcq', options: ['be', 'being', 'been', 'have been'], correct: 1, topic: 'Gerunds after Prepositions' },
                    { q: 'The extent ___ technology affects learning remains debatable.', type: 'mcq', options: ['to which', 'of which', 'in which', 'at which'], correct: 0, topic: 'Relative Clauses with Prepositions' },
                    { q: 'Having ___ the report, she submitted it immediately.', type: 'mcq', options: ['complete', 'completed', 'completing', 'to complete'], correct: 1, topic: 'Perfect Participles' },
                    { q: 'Rarely ___ such dedication in employees.', type: 'mcq', options: ['one sees', 'does one see', 'sees one', 'one does see'], correct: 1, topic: 'Inversion - Negative Adverbs' },
                    { q: 'It is imperative that students ___ academic integrity.', type: 'mcq', options: ['maintain', 'maintains', 'maintained', 'will maintain'], correct: 0, topic: 'Subjunctive - It is imperative' },
                    { q: 'No sooner ___ the announcement than people started leaving.', type: 'mcq', options: ['was made', 'made', 'had been made', 'has been made'], correct: 2, topic: 'Inversion - No sooner' },
                    { q: 'The research ___ by several universities is groundbreaking.', type: 'mcq', options: ['conducting', 'conducted', 'to conduct', 'conducts'], correct: 1, topic: 'Past Participles as Adjectives' },
                    { q: 'Should you ___ any questions, please contact us.', type: 'mcq', options: ['having', 'to have', 'have', 'had'], correct: 2, topic: 'Inversion - Should/Were/Had' }
                ]
            }
        };

        function selectLevel(level) {
            selectedLevel = level;
            document.getElementById('levelSelection').classList.remove('active');
            document.getElementById('variantSelection').classList.add('active');
        }

        function selectVariant(variant) {
            selectedVariant = variant;
            document.getElementById('initialScreens').style.display = 'none';
            document.getElementById('testInterface').style.display = 'flex';
            navigateToSection('Listening');
        }

        function navigateToSection(sectionName) {
            saveAnswers();
            currentSection = sectionName;
            
            // Update sidebar
            sections.forEach(s => {
                document.getElementById(`nav-${s}`).classList.remove('active');
            });
            document.getElementById(`nav-${sectionName}`).classList.add('active');
            
            loadSection(sectionName);
        }

        function loadSection(sectionName) {
            const sectionData = testData[selectedLevel][sectionName];
            let html = `<h2 style="color: #2c3e50; margin-bottom: 20px;">${sectionName} Section</h2>`;

            if (sectionName === 'Listening') {
                // Check if this section has variants
                const data = sectionData.variants ? sectionData.variants[selectedVariant] : sectionData;
                
                // Determine the video/audio URL to use
                let videoSrc = data.videoUrl || data.youtubeEmbed || '';
                let hasValidVideo = videoSrc && !videoSrc.includes('YOUR_AUDIO_URL') && !videoSrc.includes('dQw4w9WgXcQ');
                let hasValidAudio = data.audioUrl && !data.audioUrl.includes('YOUR_AUDIO_URL');
                
                html += `
                    <div class="instruction-note">
                        üéß ${data.description || 'Listen carefully and answer the questions below'}. You can replay as needed.
                    </div>
                    <div class="media-container">
                `;
                
                if (hasValidVideo) {
                    html += `<iframe 
                        class="video-player" 
                        width="100%" 
                        height="450" 
                        src="${videoSrc}" 
                        frameborder="0" 
                        allow="autoplay; encrypted-media" 
                        allowfullscreen></iframe>`;
                } else if (hasValidAudio) {
                    html += `<audio class="audio-player" controls>
                        <source src="${data.audioUrl}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>`;
                } else {
                    html += `<div style="padding: 40px; text-align: center; background: #fff3e0; border-radius: 10px; border: 2px dashed #ff8c00;">
                        <p style="font-size: 1.2em; color: #e65100;">‚ö†Ô∏è No Media Configured</p>
                        <p style="color: #666;">Please add a video or audio URL in the code.</p>
                    </div>`;
                }
                
                html += `</div>`;
                html += `<button class="show-answers-btn" onclick="toggleShowAllAnswers('${sectionName}')" id="showAnswersBtn_${sectionName}">
                    üëÅÔ∏è Show All Answers
                </button>`;
                data.questions.forEach((q, i) => {
                    html += createQuestion(sectionName, i, q);
                });
            } else if (sectionName === 'Reading') {
                const data = sectionData.variants ? sectionData.variants[selectedVariant] : sectionData;
                html += `
                    <div class="instruction-note">
                        üìñ Read the passage carefully and answer the questions that follow.
                    </div>
                    <div class="reading-text">
                        <h3 style="color: #2c3e50; margin-bottom: 15px;">Reading Passage</h3>
                        <p>${data.text}</p>
                    </div>
                `;
                html += `<button class="show-answers-btn" onclick="toggleShowAllAnswers('${sectionName}')" id="showAnswersBtn_${sectionName}">
                    üëÅÔ∏è Show All Answers
                </button>`;
                data.questions.forEach((q, i) => {
                    html += createQuestion(sectionName, i, q);
                });
            } else if (sectionName === 'Writing') {
                const data = sectionData.variants ? sectionData.variants[selectedVariant] : sectionData;
                html += `
                    <div class="instruction-note">
                        ‚úçÔ∏è Complete both writing tasks. Take your time to plan and organize your ideas.
                    </div>
                    <div class="question">
                        <h4>Task 1: ${selectedLevel === 'A0' ? 'Translation' : 'Chart Description'}</h4>
                        ${data.chartUrl ? `<img src="${data.chartUrl}" alt="Chart" class="chart-image">` : ''}
                        <p style="color: #7f8c8d; margin: 10px 0;">${data.task1}</p>
                        <textarea id="${sectionName}_task1" rows="8" placeholder="Write your answer here..."></textarea>
                    </div>
                    <div class="question">
                        <h4>Task 2: ${selectedLevel === 'A0' ? 'Short Writing' : 'Essay Planning'}</h4>
                        <p style="color: #7f8c8d; margin: 10px 0;">${data.task2}</p>
                        <textarea id="${sectionName}_task2" rows="10" placeholder="Write your answer here..."></textarea>
                    </div>
                `;
            } else if (sectionName === 'Speaking') {
                const data = sectionData.variants ? sectionData.variants[selectedVariant] : sectionData;
                html += `
                    <div class="instruction-note">
                        üó£Ô∏è ${data.instruction}
                    </div>
                    <div class="question">
                        <h4>Part 1: General Questions</h4>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">Practice answering these questions aloud:</p>
                        ${data.part1.map((q, i) => `<p style="margin: 12px 0; padding: 10px; background: white; border-radius: 6px;"><strong>Q${i+1}:</strong> ${q}</p>`).join('')}
                    </div>
                    <div class="cue-card">
                        <h4>Part 2: Cue Card</h4>
                        <p style="margin: 15px 0; line-height: 1.8;">${data.part2}</p>
                        <span class="timer">Preparation time: 1 minute | Speaking time: 2 minutes</span>
                    </div>
                `;
                
                if (data.part3) {
                    html += `
                        <div class="question">
                            <h4>Part 3: Discussion Questions</h4>
                            <p style="color: #7f8c8d; margin-bottom: 15px;">Discuss these more complex topics:</p>
                            ${data.part3.map((q, i) => `<p style="margin: 12px 0; padding: 10px; background: white; border-radius: 6px;"><strong>Q${i+1}:</strong> ${q}</p>`).join('')}
                        </div>
                    `;
                }
            } else if (sectionName === 'Grammar') {
                const data = sectionData.variants ? sectionData.variants[selectedVariant] : sectionData;
                html += `
                    <div class="instruction-note">
                        üìù Complete the grammar exercises below. Choose the best answer for each question.
                    </div>
                `;
                html += `<button class="show-answers-btn" onclick="toggleShowAllAnswers('${sectionName}')" id="showAnswersBtn_${sectionName}">
                    üëÅÔ∏è Show All Answers
                </button>`;
                data.forEach((q, i) => {
                    html += createQuestion(sectionName, i, q);
                });
            }

            document.getElementById('testContent').innerHTML = html;
        }

        function createQuestion(section, index, q) {
            const qId = `${section}_${index}`;
            
            // Determine the correct answer text for display
            let answerText = '';
            if (q.type === 'mcq') {
                answerText = q.options[q.correct];
            } else if (q.type === 'tf') {
                answerText = q.correct ? 'True' : 'False';
            } else if (q.type === 'short') {
                answerText = q.correct;
            } else if (q.type === 'sentence') {
                answerText = q.answer || q.correct;
            } else if (q.type === 'views') {
                const viewsMap = { 'yes': 'Yes (Author agrees)', 'no': 'No (Author disagrees)', 'notgiven': 'Not Given' };
                answerText = viewsMap[q.answer] || q.answer;
            } else if (q.type === 'match') {
                answerText = 'Check matching pairs in the question';
            }
            
            let html = `<div class="question">
                <div class="question-header">
                    <h4>Question ${index + 1}</h4>
                    <button class="hint-btn" onclick="toggleAnswer('${qId}')" title="Show Answer">üí°</button>
                </div>
                <p>${q.q}</p>`;

            if (q.type === 'mcq') {
                html += '<div class="options">';
                q.options.forEach((opt, i) => {
                    html += `
                        <div class="option">
                            <input type="radio" id="${qId}_${i}" name="${qId}" value="${i}">
                            <label for="${qId}_${i}">${opt}</label>
                        </div>
                    `;
                });
                html += '</div>';
            } else if (q.type === 'tf') {
                html += `
                    <div class="options">
                        <div class="option">
                            <input type="radio" id="${qId}_true" name="${qId}" value="true">
                            <label for="${qId}_true">True</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="${qId}_false" name="${qId}" value="false">
                            <label for="${qId}_false">False</label>
                        </div>
                    </div>
                `;
            } else if (q.type === 'short') {
                html += `<input type="text" id="${qId}" placeholder="Type your answer...">`;
            } else if (q.type === 'sentence') {
                html += `<p style="margin: 10px 0; color: #7f8c8d;">${q.stem} ___</p>`;
                html += `<input type="text" id="${qId}" placeholder="Complete the sentence...">`;
            } else if (q.type === 'match') {
                html += '<div class="match-container">';
                html += '<div><strong>Items:</strong>';
                q.pairs.forEach((pair, i) => {
                    html += `<div class="match-item">${pair[0]}</div>`;
                });
                html += '</div><div><strong>Match with:</strong>';
                q.pairs.forEach((pair, i) => {
                    html += `<div class="match-item">
                        <select id="${qId}_${i}" style="width: 100%; padding: 5px;">
                            <option value="">Select...</option>
                            ${q.pairs.map((p, j) => `<option value="${j}">${p[1]}</option>`).join('')}
                        </select>
                    </div>`;
                });
                html += '</div></div>';
            } else if (q.type === 'views') {
                html += `<p style="margin: 10px 0; color: #7f8c8d;">Statement: "${q.statement}"</p>`;
                html += `
                    <div class="options">
                        <div class="option">
                            <input type="radio" id="${qId}_yes" name="${qId}" value="yes">
                            <label for="${qId}_yes">Yes (Author agrees)</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="${qId}_no" name="${qId}" value="no">
                            <label for="${qId}_no">No (Author disagrees)</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="${qId}_notgiven" name="${qId}" value="notgiven">
                            <label for="${qId}_notgiven">Not Given</label>
                        </div>
                    </div>
                `;
            }

            html += `<div id="answer_${qId}" class="answer-key">‚úÖ Answer: ${answerText}</div>`;
            html += '</div>';
            return html;
        }

        function toggleAnswer(qId) {
            const answerDiv = document.getElementById('answer_' + qId);
            if (answerDiv) {
                answerDiv.classList.toggle('show');
            }
        }

        function toggleShowAllAnswers(sectionName) {
            const btn = document.getElementById(`showAnswersBtn_${sectionName}`);
            const isShowing = btn.classList.contains('active');
            
            const sectionData = testData[selectedLevel][sectionName];
            let data;
            if (sectionData.variants) {
                data = sectionData.variants[selectedVariant];
            } else {
                data = sectionData;
            }
            const questions = sectionName === 'Grammar' ? data : data.questions;
            
            if (isShowing) {
                // Hide all answers and remove highlighting
                btn.classList.remove('active');
                btn.innerHTML = 'üëÅÔ∏è Show All Answers';
                
                questions.forEach((q, i) => {
                    const qId = `${sectionName}_${i}`;
                    const answerDiv = document.getElementById('answer_' + qId);
                    if (answerDiv) {
                        answerDiv.classList.remove('show');
                    }
                    
                    // Remove highlighting from options
                    const options = document.querySelectorAll(`input[name="${qId}"]`);
                    options.forEach(opt => {
                        const optionDiv = opt.closest('.option');
                        if (optionDiv) {
                            optionDiv.classList.remove('correct-answer', 'wrong-answer');
                            const indicator = optionDiv.querySelector('.answer-indicator');
                            if (indicator) indicator.remove();
                        }
                    });
                    
                    // Remove input answer displays
                    const inputDisplay = document.getElementById(`input_display_${qId}`);
                    if (inputDisplay) {
                        inputDisplay.classList.remove('show');
                    }
                });
            } else {
                // Show all answers with highlighting
                btn.classList.add('active');
                btn.innerHTML = 'üôà Hide All Answers';
                
                questions.forEach((q, i) => {
                    const qId = `${sectionName}_${i}`;
                    const answerDiv = document.getElementById('answer_' + qId);
                    if (answerDiv) {
                        answerDiv.classList.add('show');
                    }
                    
                    // Highlight correct/wrong answers for MCQ, TF, Views
                    if (q.type === 'mcq') {
                        const selected = document.querySelector(`input[name="${qId}"]:checked`);
                        const options = document.querySelectorAll(`input[name="${qId}"]`);
                        
                        options.forEach((opt, optIndex) => {
                            const optionDiv = opt.closest('.option');
                            if (optionDiv) {
                                optionDiv.classList.remove('correct-answer', 'wrong-answer');
                                const existingIndicator = optionDiv.querySelector('.answer-indicator');
                                if (existingIndicator) existingIndicator.remove();
                                
                                if (optIndex === q.correct) {
                                    optionDiv.classList.add('correct-answer');
                                    const indicator = document.createElement('span');
                                    indicator.className = 'answer-indicator correct';
                                    indicator.textContent = '‚úì Correct';
                                    optionDiv.appendChild(indicator);
                                } else if (selected && opt === selected) {
                                    optionDiv.classList.add('wrong-answer');
                                    const indicator = document.createElement('span');
                                    indicator.className = 'answer-indicator wrong';
                                    indicator.textContent = '‚úó Your answer';
                                    optionDiv.appendChild(indicator);
                                }
                            }
                        });
                    } else if (q.type === 'tf') {
                        const selected = document.querySelector(`input[name="${qId}"]:checked`);
                        const correctValue = String(q.correct);
                        const options = document.querySelectorAll(`input[name="${qId}"]`);
                        
                        options.forEach(opt => {
                            const optionDiv = opt.closest('.option');
                            if (optionDiv) {
                                optionDiv.classList.remove('correct-answer', 'wrong-answer');
                                const existingIndicator = optionDiv.querySelector('.answer-indicator');
                                if (existingIndicator) existingIndicator.remove();
                                
                                if (opt.value === correctValue) {
                                    optionDiv.classList.add('correct-answer');
                                    const indicator = document.createElement('span');
                                    indicator.className = 'answer-indicator correct';
                                    indicator.textContent = '‚úì Correct';
                                    optionDiv.appendChild(indicator);
                                } else if (selected && opt === selected) {
                                    optionDiv.classList.add('wrong-answer');
                                    const indicator = document.createElement('span');
                                    indicator.className = 'answer-indicator wrong';
                                    indicator.textContent = '‚úó Your answer';
                                    optionDiv.appendChild(indicator);
                                }
                            }
                        });
                    } else if (q.type === 'views') {
                        const selected = document.querySelector(`input[name="${qId}"]:checked`);
                        const correctValue = q.answer;
                        const options = document.querySelectorAll(`input[name="${qId}"]`);
                        
                        options.forEach(opt => {
                            const optionDiv = opt.closest('.option');
                            if (optionDiv) {
                                optionDiv.classList.remove('correct-answer', 'wrong-answer');
                                const existingIndicator = optionDiv.querySelector('.answer-indicator');
                                if (existingIndicator) existingIndicator.remove();
                                
                                if (opt.value === correctValue) {
                                    optionDiv.classList.add('correct-answer');
                                    const indicator = document.createElement('span');
                                    indicator.className = 'answer-indicator correct';
                                    indicator.textContent = '‚úì Correct';
                                    optionDiv.appendChild(indicator);
                                } else if (selected && opt === selected) {
                                    optionDiv.classList.add('wrong-answer');
                                    const indicator = document.createElement('span');
                                    indicator.className = 'answer-indicator wrong';
                                    indicator.textContent = '‚úó Your answer';
                                    optionDiv.appendChild(indicator);
                                }
                            }
                        });
                    } else if (q.type === 'short' || q.type === 'sentence') {
                        const inputEl = document.getElementById(qId);
                        if (inputEl) {
                            const userAnswer = inputEl.value.trim().toLowerCase();
                            const correctAnswer = (q.answer || q.correct || '').toLowerCase().trim();
                            const isCorrect = userAnswer && (
                                userAnswer === correctAnswer ||
                                userAnswer.includes(correctAnswer) ||
                                correctAnswer.includes(userAnswer)
                            );
                            
                            // Create or update display element
                            let displayEl = document.getElementById(`input_display_${qId}`);
                            if (!displayEl) {
                                displayEl = document.createElement('div');
                                displayEl.id = `input_display_${qId}`;
                                displayEl.className = 'input-answer-display';
                                inputEl.parentNode.insertBefore(displayEl, inputEl.nextSibling);
                            }
                            
                            if (userAnswer) {
                                displayEl.className = `input-answer-display show ${isCorrect ? 'correct' : 'wrong'}`;
                                displayEl.innerHTML = isCorrect 
                                    ? `‚úì Your answer is correct!`
                                    : `‚úó Your answer: "${inputEl.value}" ‚Äî Correct answer: "${q.answer || q.correct}"`;
                            } else {
                                displayEl.className = 'input-answer-display show wrong';
                                displayEl.innerHTML = `‚ö†Ô∏è No answer provided ‚Äî Correct answer: "${q.answer || q.correct}"`;
                            }
                        }
                    }
                });
            }
        }

        function saveAnswers() {
            const sectionName = currentSection;
            answers[sectionName] = {};

            if (sectionName === 'Writing') {
                const task1El = document.getElementById(`${sectionName}_task1`);
                const task2El = document.getElementById(`${sectionName}_task2`);
                if (task1El) answers[sectionName].task1 = task1El.value;
                if (task2El) answers[sectionName].task2 = task2El.value;
            } else if (sectionName === 'Speaking') {
                // Speaking section doesn't require saving text answers
                answers[sectionName].completed = true;
            } else {
                const sectionData = testData[selectedLevel][sectionName];
                // Handle variants structure for Listening
                let data;
                if (sectionData.variants) {
                    data = sectionData.variants[selectedVariant];
                } else {
                    data = sectionData;
                }
                const questions = sectionName === 'Grammar' ? data : data.questions;
                
                questions.forEach((q, i) => {
                    const qId = `${sectionName}_${i}`;
                    if (q.type === 'mcq' || q.type === 'tf' || q.type === 'views') {
                        const selected = document.querySelector(`input[name="${qId}"]:checked`);
                        answers[sectionName][i] = selected ? selected.value : null;
                    } else if (q.type === 'short' || q.type === 'sentence') {
                        const el = document.getElementById(qId);
                        answers[sectionName][i] = el ? el.value : '';
                    } else if (q.type === 'match') {
                        answers[sectionName][i] = [];
                        q.pairs.forEach((pair, j) => {
                            const el = document.getElementById(`${qId}_${j}`);
                            if (el) answers[sectionName][i].push(el.value);
                        });
                    }
                });
            }
            
            completedSections.add(sectionName);
            document.getElementById(`nav-${sectionName}`).classList.add('completed');
        }

        function showResults() {
            saveAnswers();
            document.getElementById('testInterface').style.display = 'none';
            document.getElementById('resultsInterface').style.display = 'block';

            let html = `<div class="results">`;
            let totalScore = 0;
            let maxScore = 0;

            sections.forEach(section => {
                if (section === 'Writing') {
                    const writingAnswers = answers['Writing'] || {};
                    const hasTask1 = writingAnswers.task1 && writingAnswers.task1.trim();
                    const hasTask2 = writingAnswers.task2 && writingAnswers.task2.trim();
                    
                    html += `
                        <div class="result-section">
                            <h3>${section}</h3>
                            <p style="color: #7f8c8d;">This section requires manual evaluation by an instructor.</p>
                            <div style="background: #f0f4ff; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <strong>‚úì Your responses have been recorded for review.</strong>
                            </div>
                            ${(hasTask1 || hasTask2) ? `
                                <button class="writing-answer-btn" onclick="toggleWritingAnswers()">
                                    üìù Show Writing Answers
                                </button>
                                <div id="writingAnswerContainer" class="writing-answer-container">
                                    ${hasTask1 ? `
                                        <div style="margin-bottom: 20px;">
                                            <h4>Task 1 Answer <button class="copy-btn" onclick="copyToClipboard('task1Content', this)">üìã Copy</button></h4>
                                            <pre id="task1Content">${escapeHtml(writingAnswers.task1)}</pre>
                                        </div>
                                    ` : `<p style="color: #7f8c8d; font-style: italic;">Task 1: No answer provided</p>`}
                                    ${hasTask2 ? `
                                        <div>
                                            <h4>Task 2 Answer <button class="copy-btn" onclick="copyToClipboard('task2Content', this)">üìã Copy</button></h4>
                                            <pre id="task2Content">${escapeHtml(writingAnswers.task2)}</pre>
                                        </div>
                                    ` : `<p style="color: #7f8c8d; font-style: italic;">Task 2: No answer provided</p>`}
                                </div>
                            ` : `<p style="color: #e65100; margin-top: 10px;">‚ö†Ô∏è No writing responses were submitted.</p>`}
                        </div>
                    `;
                } else if (section === 'Speaking') {
                    html += `
                        <div class="result-section">
                            <h3>${section}</h3>
                            <p style="color: #7f8c8d;">This section requires manual evaluation by an instructor.</p>
                            <div style="background: #f0f4ff; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <strong>‚úì Your responses have been recorded for review.</strong>
                            </div>
                        </div>
                    `;
                } else {
                    const result = calculateSectionScore(section);
                    totalScore += result.score;
                    maxScore += result.total;

                    html += `
                        <div class="result-section">
                            <h3>${section}</h3>
                            <div class="score">${result.score} / ${result.total}</div>
                            <p style="color: #7f8c8d; margin: 10px 0;">Performance: ${result.percentage}%</p>
                            
                            ${result.recommendations.length > 0 ? 
                                `<div style="margin-top: 15px;">
                                    <strong style="color: #2c3e50;">Recommendations:</strong>
                                    ${result.recommendations.map(rec => 
                                        `<div class="recommendation">üìå ${rec}</div>`
                                    ).join('')}
                                </div>` : 
                                `<div class="recommendation" style="background: #e8f5e9; color: #2e7d32;">
                                    ‚úÖ Excellent performance across all question types!
                                </div>`
                            }
                            
                            ${section === 'Grammar' && result.grammarTopics ? 
                                `<div style="margin-top: 15px;">
                                    <strong style="color: #2c3e50;">Grammar Topics to Review:</strong>
                                    ${result.grammarTopics.map(topic => 
                                        `<div class="grammar-topic">üìö ${topic}</div>`
                                    ).join('')}
                                </div>` : ''
                            }
                        </div>
                    `;
                }
            });

            const overallPercentage = maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;
            
            html += `
                <div class="result-section" style="border-left-color: #ff8c00; background: linear-gradient(135deg, #fff5f0 0%, #f0f7ff 100%);">
                    <h3>Overall Assessment</h3>
                    <div class="score">${totalScore} / ${maxScore}</div>
                    <p style="color: #7f8c8d; margin: 10px 0;">Overall Performance: ${overallPercentage}%</p>
                    <div class="recommendation">
                        <strong>Level Assessment:</strong> 
                        ${overallPercentage >= 80 ? 'Excellent! Strong proficiency at this level. Consider advancing to the next level.' :
                          overallPercentage >= 60 ? 'Good work! Solid understanding with room for improvement in specific areas.' :
                          overallPercentage >= 40 ? 'Fair performance. Focus on the weak areas identified above for improvement.' :
                          'Additional practice needed. Review fundamentals and consider working with an instructor.'}
                    </div>
                </div>
            `;

            html += `</div>`;
            document.getElementById('resultsContent').innerHTML = html;
            window.scrollTo(0, 0);
        }

        function calculateSectionScore(section) {
            const sectionData = testData[selectedLevel][section];
            // Handle variants structure for Listening
            let data;
            if (sectionData.variants) {
                data = sectionData.variants[selectedVariant];
            } else {
                data = sectionData;
            }
            const questions = section === 'Grammar' ? data : data.questions;
            const userAnswers = answers[section] || {};

            let score = 0;
            let total = questions.length;
            const typeStats = {};
            const grammarTopicStats = {};

            questions.forEach((q, i) => {
                const userAnswer = userAnswers[i];
                let correct = false;

                if (q.type === 'mcq') {
                    correct = userAnswer == q.correct;
                } else if (q.type === 'tf') {
                    correct = userAnswer === String(q.correct);
                } else if (q.type === 'short') {
                    if (userAnswer && q.correct) {
                        const userLower = userAnswer.toLowerCase().trim();
                        const correctLower = q.correct.toLowerCase().trim();
                        // Case-insensitive exact match, or check if either contains the other
                        correct = userLower === correctLower || 
                                  userLower.includes(correctLower) || 
                                  correctLower.includes(userLower);
                    }
                } else if (q.type === 'sentence') {
                    // Sentence type uses 'answer' property instead of 'correct'
                    const correctAnswer = q.answer || q.correct;
                    if (userAnswer && correctAnswer) {
                        const userLower = userAnswer.toLowerCase().trim();
                        const correctLower = correctAnswer.toLowerCase().trim();
                        // Case-insensitive exact match, or check if either contains the other
                        correct = userLower === correctLower || 
                                  userLower.includes(correctLower) || 
                                  correctLower.includes(userLower);
                    }
                } else if (q.type === 'match') {
                    if (Array.isArray(userAnswer) && q.correctPairs) {
                        let matchCount = 0;
                        userAnswer.forEach((ans, j) => {
                            if (q.correctPairs.some(pair => 
                                pair[0] === q.pairs[j][0] && pair[1] === q.pairs[parseInt(ans)][1]
                            )) {
                                matchCount++;
                            }
                        });
                        correct = matchCount >= q.correctPairs.length;
                    }
                } else if (q.type === 'views') {
                    correct = userAnswer === q.answer;
                }

                if (correct) score++;

                // Track by question type
                if (!typeStats[q.type]) {
                    typeStats[q.type] = { correct: 0, total: 0 };
                }
                typeStats[q.type].total++;
                if (correct) typeStats[q.type].correct++;

                // Track grammar topics
                if (section === 'Grammar' && q.topic) {
                    if (!grammarTopicStats[q.topic]) {
                        grammarTopicStats[q.topic] = { correct: 0, total: 0 };
                    }
                    grammarTopicStats[q.topic].total++;
                    if (correct) grammarTopicStats[q.topic].correct++;
                }
            });

            const percentage = Math.round((score / total) * 100);
            const recommendations = [];

            Object.keys(typeStats).forEach(type => {
                const stat = typeStats[type];
                const typePercentage = Math.round((stat.correct / stat.total) * 100);
                const typeName = {
                    'mcq': 'Multiple Choice',
                    'tf': 'True/False',
                    'short': 'Short Answer',
                    'sentence': 'Sentence Completion',
                    'match': 'Matching',
                    'views': 'Identifying Writer\'s Views'
                }[type] || type;

                if (typePercentage < 60) {
                    recommendations.push(`${typeName}: ${stat.correct}/${stat.total} - Work on ${typeName} question types`);
                } else if (typePercentage < 80) {
                    recommendations.push(`${typeName}: ${stat.correct}/${stat.total} - Good progress, continue practicing`);
                }
            });

            // Grammar topics analysis
            let grammarTopics = [];
            if (section === 'Grammar') {
                Object.keys(grammarTopicStats).forEach(topic => {
                    const stat = grammarTopicStats[topic];
                    const topicPercentage = Math.round((stat.correct / stat.total) * 100);
                    if (topicPercentage < 70) {
                        grammarTopics.push(`${topic} (${stat.correct}/${stat.total} correct)`);
                    }
                });
            }

            return { 
                score, 
                total, 
                percentage, 
                recommendations,
                grammarTopics: grammarTopics.length > 0 ? grammarTopics : null
            };
        }

        function toggleWritingAnswers() {
            const container = document.getElementById('writingAnswerContainer');
            const btn = event.target;
            if (container) {
                container.classList.toggle('show');
                if (container.classList.contains('show')) {
                    btn.innerHTML = 'üôà Hide Writing Answers';
                } else {
                    btn.innerHTML = 'üìù Show Writing Answers';
                }
            }
        }

        function copyToClipboard(elementId, btn) {
            const element = document.getElementById(elementId);
            if (element) {
                const text = element.textContent;
                navigator.clipboard.writeText(text).then(() => {
                    btn.classList.add('copied');
                    btn.textContent = '‚úì Copied!';
                    setTimeout(() => {
                        btn.classList.remove('copied');
                        btn.textContent = 'üìã Copy';
                    }, 2000);
                }).catch(err => {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    btn.classList.add('copied');
                    btn.textContent = '‚úì Copied!';
                    setTimeout(() => {
                        btn.classList.remove('copied');
                        btn.textContent = 'üìã Copy';
                    }, 2000);
                });
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function restartTest() {
            // Clear all state
            selectedLevel = '';
            selectedVariant = 0;
            currentSection = 'Listening';
            answers = {};
            completedSections.clear();
            
            // Clear the test content area
            document.getElementById('testContent').innerHTML = '';
            document.getElementById('resultsContent').innerHTML = '';
            
            // Clear export fields
            const studentNameField = document.getElementById('studentName');
            const descriptionField = document.getElementById('testDescription');
            if (studentNameField) studentNameField.value = '';
            if (descriptionField) descriptionField.value = '';
            
            // Reset UI
            document.getElementById('resultsInterface').style.display = 'none';
            document.getElementById('testInterface').style.display = 'none';
            document.getElementById('initialScreens').style.display = 'block';
            document.getElementById('levelSelection').classList.add('active');
            document.getElementById('variantSelection').classList.remove('active');
            
            // Reset sidebar
            sections.forEach(s => {
                document.getElementById(`nav-${s}`).classList.remove('active', 'completed');
            });
        }

        function backToMainMenu() {
            if (confirm('Are you sure you want to go back to the main menu? Your progress will be lost.')) {
                restartTest();
            }
        }

        // Export to Word functionality
        async function exportToWord() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Generating...';

            try {
                // Use globally loaded docx library
                const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = window.docx;

                const studentName = document.getElementById('studentName').value || '________________';
                const testDescription = document.getElementById('testDescription').value || '';
                const testDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

                const children = [];

                // Title
                children.push(new Paragraph({
                    children: [new TextRun({ text: 'Language Level Assessment Results', bold: true, size: 48 })],
                    alignment: AlignmentType.CENTER,
                    spacing: { after: 300 }
                }));

                // Student Info Section
                children.push(new Paragraph({
                    children: [new TextRun({ text: 'Student Name: ', bold: true, size: 24 }), new TextRun({ text: studentName, size: 24 })],
                    spacing: { after: 100 }
                }));

                children.push(new Paragraph({
                    children: [new TextRun({ text: 'Test Level: ', bold: true, size: 24 }), new TextRun({ text: selectedLevel, size: 24 })],
                    spacing: { after: 100 }
                }));

                children.push(new Paragraph({
                    children: [new TextRun({ text: 'Variant: ', bold: true, size: 24 }), new TextRun({ text: String(selectedVariant), size: 24 })],
                    spacing: { after: 100 }
                }));

                children.push(new Paragraph({
                    children: [new TextRun({ text: 'Date: ', bold: true, size: 24 }), new TextRun({ text: testDate, size: 24 })],
                    spacing: { after: 200 }
                }));

                if (testDescription) {
                    children.push(new Paragraph({
                        children: [new TextRun({ text: 'Description / Notes:', bold: true, size: 24 })],
                        spacing: { before: 100 }
                    }));
                    children.push(new Paragraph({
                        children: [new TextRun({ text: testDescription, size: 24, italics: true })],
                        spacing: { after: 300 }
                    }));
                }

                // Divider
                children.push(new Paragraph({
                    children: [new TextRun({ text: '‚îÄ'.repeat(50), size: 24 })],
                    alignment: AlignmentType.CENTER,
                    spacing: { before: 200, after: 200 }
                }));

                // Process each section
                let totalScore = 0;
                let maxScore = 0;

                for (const section of sections) {
                    // Section Header
                    children.push(new Paragraph({
                        children: [new TextRun({ text: `${section} Section`, bold: true, size: 32 })],
                        spacing: { before: 300, after: 150 }
                    }));

                    if (section === 'Writing') {
                        // Writing Section - Show student answers
                        children.push(new Paragraph({
                            children: [new TextRun({ text: 'Score: ', bold: true, size: 24 }), new TextRun({ text: 'Manual Evaluation Required', size: 24, italics: true })],
                            spacing: { after: 150 }
                        }));

                        const writingAnswers = answers['Writing'] || {};
                        
                        // Task 1
                        children.push(new Paragraph({
                            children: [new TextRun({ text: 'Task 1 Answer:', bold: true, size: 24 })],
                            spacing: { before: 150 }
                        }));
                        
                        if (writingAnswers.task1 && writingAnswers.task1.trim()) {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: writingAnswers.task1, size: 22 })],
                                spacing: { after: 150 },
                                indent: { left: 360 }
                            }));
                        } else {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: '(No answer provided)', size: 22, italics: true })],
                                spacing: { after: 150 },
                                indent: { left: 360 }
                            }));
                        }

                        // Task 2
                        children.push(new Paragraph({
                            children: [new TextRun({ text: 'Task 2 Answer:', bold: true, size: 24 })],
                            spacing: { before: 150 }
                        }));
                        
                        if (writingAnswers.task2 && writingAnswers.task2.trim()) {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: writingAnswers.task2, size: 22 })],
                                spacing: { after: 200 },
                                indent: { left: 360 }
                            }));
                        } else {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: '(No answer provided)', size: 22, italics: true })],
                                spacing: { after: 200 },
                                indent: { left: 360 }
                            }));
                        }

                    } else if (section === 'Speaking') {
                        // Speaking Section - Empty space for transcribed answer
                        children.push(new Paragraph({
                            children: [new TextRun({ text: 'Score: ', bold: true, size: 24 }), new TextRun({ text: 'Manual Evaluation Required', size: 24, italics: true })],
                            spacing: { after: 150 }
                        }));

                        const sectionData = testData[selectedLevel][section];
                        const data = sectionData.variants ? sectionData.variants[selectedVariant] : sectionData;

                        // Part 1 Questions
                        children.push(new Paragraph({
                            children: [new TextRun({ text: 'Part 1 - General Questions:', bold: true, size: 24 })],
                            spacing: { before: 150, after: 100 }
                        }));

                        data.part1.forEach((q, i) => {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: `Q${i+1}: ${q}`, size: 22 })],
                                indent: { left: 360 }
                            }));
                            children.push(new Paragraph({
                                children: [new TextRun({ text: 'Answer: ________________________________________', size: 22 })],
                                spacing: { after: 150 },
                                indent: { left: 360 }
                            }));
                        });

                        // Part 2 Cue Card
                        children.push(new Paragraph({
                            children: [new TextRun({ text: 'Part 2 - Cue Card:', bold: true, size: 24 })],
                            spacing: { before: 150, after: 100 }
                        }));

                        children.push(new Paragraph({
                            children: [new TextRun({ text: data.part2, size: 22, italics: true })],
                            indent: { left: 360 }
                        }));

                        children.push(new Paragraph({
                            children: [new TextRun({ text: 'Transcribed Answer:', bold: true, size: 22 })],
                            spacing: { before: 150 },
                            indent: { left: 360 }
                        }));

                        // Empty lines for transcription
                        for (let i = 0; i < 6; i++) {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: '_'.repeat(70), size: 22 })],
                                spacing: { after: 100 },
                                indent: { left: 360 }
                            }));
                        }

                        // Part 3 if exists
                        if (data.part3) {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: 'Part 3 - Discussion Questions:', bold: true, size: 24 })],
                                spacing: { before: 200, after: 100 }
                            }));

                            data.part3.forEach((q, i) => {
                                children.push(new Paragraph({
                                    children: [new TextRun({ text: `Q${i+1}: ${q}`, size: 22 })],
                                    indent: { left: 360 }
                                }));
                                children.push(new Paragraph({
                                    children: [new TextRun({ text: 'Answer: ________________________________________', size: 22 })],
                                    spacing: { after: 150 },
                                    indent: { left: 360 }
                                }));
                            });
                        }

                    } else {
                        // Listening, Reading, Grammar - Score sections
                        const result = calculateSectionScore(section);
                        totalScore += result.score;
                        maxScore += result.total;

                        children.push(new Paragraph({
                            children: [
                                new TextRun({ text: 'Score: ', bold: true, size: 24 }),
                                new TextRun({ text: `${result.score} / ${result.total}`, size: 24, bold: true }),
                                new TextRun({ text: `  (${result.percentage}%)`, size: 24 })
                            ],
                            spacing: { after: 150 }
                        }));

                        // Performance level
                        let performanceLevel = '';
                        if (result.percentage >= 80) performanceLevel = 'Excellent';
                        else if (result.percentage >= 60) performanceLevel = 'Good';
                        else if (result.percentage >= 40) performanceLevel = 'Fair';
                        else performanceLevel = 'Needs Improvement';

                        children.push(new Paragraph({
                            children: [
                                new TextRun({ text: 'Performance: ', bold: true, size: 24 }),
                                new TextRun({ text: performanceLevel, size: 24 })
                            ],
                            spacing: { after: 150 }
                        }));

                        // Recommendations
                        if (result.recommendations.length > 0) {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: 'Recommendations:', bold: true, size: 24 })],
                                spacing: { before: 100, after: 50 }
                            }));

                            result.recommendations.forEach(rec => {
                                children.push(new Paragraph({
                                    children: [new TextRun({ text: `‚Ä¢ ${rec}`, size: 22 })],
                                    indent: { left: 360 },
                                    spacing: { after: 50 }
                                }));
                            });
                        } else {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: '‚úì Excellent performance across all question types!', size: 22, italics: true })],
                                spacing: { after: 100 }
                            }));
                        }

                        // Grammar topics to review
                        if (section === 'Grammar' && result.grammarTopics) {
                            children.push(new Paragraph({
                                children: [new TextRun({ text: 'Grammar Topics to Review:', bold: true, size: 24 })],
                                spacing: { before: 100, after: 50 }
                            }));

                            result.grammarTopics.forEach(topic => {
                                children.push(new Paragraph({
                                    children: [new TextRun({ text: `‚Ä¢ ${topic}`, size: 22 })],
                                    indent: { left: 360 },
                                    spacing: { after: 50 }
                                }));
                            });
                        }
                    }

                    // Section divider
                    children.push(new Paragraph({
                        children: [new TextRun({ text: '‚îÄ'.repeat(40), size: 20, color: 'CCCCCC' })],
                        alignment: AlignmentType.CENTER,
                        spacing: { before: 100, after: 100 }
                    }));
                }

                // Overall Assessment
                const overallPercentage = maxScore > 0 ? Math.round((totalScore / maxScore) * 100) : 0;
                
                children.push(new Paragraph({
                    children: [new TextRun({ text: 'Overall Assessment', bold: true, size: 36 })],
                    spacing: { before: 300, after: 150 }
                }));

                children.push(new Paragraph({
                    children: [
                        new TextRun({ text: 'Total Score: ', bold: true, size: 28 }),
                        new TextRun({ text: `${totalScore} / ${maxScore}`, size: 28, bold: true }),
                        new TextRun({ text: `  (${overallPercentage}%)`, size: 28 })
                    ],
                    spacing: { after: 150 }
                }));

                let overallAssessment = '';
                if (overallPercentage >= 80) overallAssessment = 'Excellent! Strong proficiency at this level. Consider advancing to the next level.';
                else if (overallPercentage >= 60) overallAssessment = 'Good work! Solid understanding with room for improvement in specific areas.';
                else if (overallPercentage >= 40) overallAssessment = 'Fair performance. Focus on the weak areas identified above for improvement.';
                else overallAssessment = 'Additional practice needed. Review fundamentals and consider working with an instructor.';

                children.push(new Paragraph({
                    children: [new TextRun({ text: overallAssessment, size: 24, italics: true })],
                    spacing: { after: 300 }
                }));

                // Instructor Notes Section
                children.push(new Paragraph({
                    children: [new TextRun({ text: 'Instructor Notes:', bold: true, size: 28 })],
                    spacing: { before: 200, after: 100 }
                }));

                for (let i = 0; i < 5; i++) {
                    children.push(new Paragraph({
                        children: [new TextRun({ text: '_'.repeat(80), size: 22 })],
                        spacing: { after: 100 }
                    }));
                }

                // Create document
                const doc = new Document({
                    sections: [{
                        properties: {
                            page: {
                                size: { width: 12240, height: 15840 },
                                margin: { top: 1440, right: 1440, bottom: 1440, left: 1440 }
                            }
                        },
                        children: children
                    }]
                });

                // Generate and download
                const buffer = await Packer.toBlob(doc);
                const url = URL.createObjectURL(buffer);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Assessment_Results_${selectedLevel}_${studentName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.docx`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                btn.disabled = false;
                btn.innerHTML = '‚úì Downloaded!';
                setTimeout(() => {
                    btn.innerHTML = 'üì• Export to Word Document';
                }, 2000);

            } catch (error) {
                console.error('Export error:', error);
                btn.disabled = false;
                btn.innerHTML = '‚ùå Export Failed - Try Again';
                setTimeout(() => {
                    btn.innerHTML = 'üì• Export to Word Document';
                }, 3000);
            }
        }
    </script>
</body>
</html>
